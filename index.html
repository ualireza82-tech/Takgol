DOCTYPE html> 

<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>قرآن آنلاین معنوی</title>
<link href="https://fonts.googleapis.com/css2?family=Scheherazade+New&display=swap" rel="stylesheet">
<style>
body { margin:0; font-family:'Scheherazade New','Tahoma',sans-serif; background:linear-gradient(to bottom,#fdf6e3,#e0ffe0); color:#111; }
header { text-align:center; padding:18px; background:#006400; color:#fff; font-size:1.7em; box-shadow:0 4px 10px rgba(0,0,0,0.3);}
.container { max-width:900px; margin:20px auto; padding:10px; }
.sura-card { background:#fff; border-radius:18px; box-shadow:0 5px 12px rgba(0,0,0,0.2); margin-bottom:18px; padding:15px; cursor:pointer; transition:0.3s; }
.sura-card:hover { box-shadow:0 8px 18px rgba(0,0,0,0.3); transform:scale(1.02);}
.sura-title { font-weight:bold; font-size:1.4em; color:#006400; text-align:center; }
.back-btn { display:block; margin:15px auto; padding:10px 20px; background:#006400; color:#fff; border:none; border-radius:10px; cursor:pointer; font-size:1.1em; }
.back-btn:hover { background:#004d00; }
.aya-text { font-size:1.7em; line-height:2.8; text-align:right; padding:12px; margin-bottom:0; border-radius:12px; background:#fffaf0; box-shadow:0 3px 8px rgba(0,0,0,0.15); max-width:95%; margin-left:auto; margin-right:auto; }
.quran-page { background:#fff; border-radius:18px; padding:22px; box-shadow:0 3px 8px rgba(0,0,0,0.1); margin-top:12px; display:flex; justify-content:center; }
@media (min-width:600px){ .aya-text { font-size:1.9em; line-height:3; } }
</style>
</head>
<body>
<header>قرآن آنلاین معنوی</header>
<div class="container" id="quran-container">
  <div id="loading" style="text-align:center; padding:20px;"></div>
</div>

<script>
const ayaSamples = [
  {
    aya: "﴿ إِنَّ الَّذِينَ يَتْلُونَ كِتَابَ اللَّهِ وَأَقَامُوا الصَّلَاةَ وَأَنفَقُوا مِمَّا رَزَقْنَاهُمْ سِرًّا وَعَلَانِيَةً يَرْجُونَ تِجَارَةً لَّن تَبُورَ ﴾ (فاطر: ۲۹)",
    text: "در حال بارگذاری قرآن کریم... صبر کنید تا آیات الهی آماده شوند. تلاوت قرآن، نوری برای قلب و آرامشی برای روح است. لحظاتی دیگر درهای معرفت و آرامش بر شما گشوده خواهد شد."
  },
  {
    aya: "﴿ وَإِذَا سَأَلَكَ عِبَادِي عَنِّي فَإِنِّي قَرِيبٌ ﴾ (بقره: ۱۸۶)",
    text: "در حال آماده‌سازی آیات شریف قرآن... نفس عمیق بکشید و قلب خود را با نور الهی پر کنید. لحظاتی دیگر می‌توانید سوره‌ها و آیات را مشاهده کنید."
  },
  {
    aya: "﴿ إِنَّ مَعَ الْعُسْرِ يُسْرًا ﴾ (الشرح: ۶)",
    text: "بارگذاری قرآن در جریان است. صبر و آرامش همراه شماست. هر لحظه که انتظار می‌کشید، روح شما با یاد خدا قوت می‌گیرد و آماده دریافت کلمات الهی می‌شود."
  }
];

// نمایش آیه و متن رندوم هنگام بارگذاری
const randomAya = ayaSamples[Math.floor(Math.random() * ayaSamples.length)];
document.getElementById("loading").innerHTML = 
  <p style="font-size:1.5em; line-height:2.3; color:#006400;">${randomAya.aya}</p>
  <p style="font-size:1.1em; line-height:2; color:#444; max-width:700px; margin:auto;">
    ${randomAya.text}
  </p>
;

const apiAr = "https://api.alquran.cloud/v1/quran/ar.alafasy";
let arabicData;
let audio = new Audio();
let currentAyaIndex = 0;
let currentSura = null;
let isPlaying = false;

async function loadSuras() {
  const container = document.getElementById('quran-container');
  try {
    const resAr = await fetch(apiAr);
    arabicData = await resAr.json();
    container.innerHTML = ""; // حذف متن بارگذاری و نمایش لیست سوره‌ها

    arabicData.data.surahs.forEach((sura, index)=>{
      const suraDiv = document.createElement('div');
      suraDiv.className = 'sura-card';
      const title = document.createElement('div');
      title.className = 'sura-title';
      title.innerText = ${sura.number}. ${sura.englishName} (${sura.name});
      suraDiv.appendChild(title);
      suraDiv.onclick = ()=> openSura(index);
      container.appendChild(suraDiv);
    });
  } catch(err){
    container.innerHTML = "بارگذاری قرآن با خطا مواجه شد.";
    console.error(err);
  }
}

function openSura(index) {
  const container = document.getElementById('quran-container');
  container
  .innerHTML = "";

  currentSura = arabicData.data.surahs[index];
  currentAyaIndex = 0;
  isPlaying = false;

  const backBtn = document.createElement('button');
  backBtn.className = 'back-btn';
  backBtn.innerText = "بازگشت به لیست سوره‌ها";
  backBtn.onclick = ()=> {
    audio.pause();
    audio.currentTime = 0;
    loadSuras();
  };
  container.appendChild(backBtn);

  const suraTitle = document.createElement('div');
  suraTitle.className = 'sura-title';
  suraTitle.style.fontSize = '1.7em';
  suraTitle.style.marginBottom = '18px';
  suraTitle.innerText = `${currentSura.number}. ${currentSura.englishName} (${currentSura.name})`;
  container.appendChild(suraTitle);

  const playBtn = document.createElement('button');
  playBtn.className = 'back-btn';
  playBtn.innerText = "🔊 پخش کل سوره";
  container.appendChild(playBtn);

  const quranPage = document.createElement('div');
  quranPage.className = 'quran-page';
  const fullText = currentSura.ayahs.map(a => a.text).join(" ");
  const ayaDiv = document.createElement('div');
  ayaDiv.className = 'aya-text';
  ayaDiv.innerText = fullText;
  quranPage.appendChild(ayaDiv);
  container.appendChild(quranPage);

  playBtn.onclick = ()=>{
    if (!isPlaying) {
      isPlaying = true;
      playBtn.innerText = "⏸ توقف پخش";
      playNextAya();
    } else {
      isPlaying = false;
      playBtn.innerText = "🔊 پخش کل سوره";
      audio.pause();
    }
  };
}

function playNextAya() {
  if (!currentSura || currentAyaIndex >= currentSura.ayahs.length || !isPlaying) return;
  audio.src = currentSura.ayahs[currentAyaIndex].audio;
  audio.play();
  currentAyaIndex++;
  audio.onended = () => { if(isPlaying) playNextAya(); };
}

loadSuras();
</script>
</body>
</html>